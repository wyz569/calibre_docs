<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2021" />
<meta name="DC.rights.owner" content="(C) Copyright 2021" />
<meta name="DC.Type" content="TaskTopic" />
<meta name="DC.Title" content="Creating an Activity Log Application" />
<meta name="abstract" content="In this procedure, you create a CalCM Activity Log application." />
<meta name="description" content="In this procedure, you create a CalCM Activity Log application." />
<meta name="DC.subject" content="Applications, creating" />
<meta name="keywords" content="Applications, creating" />
<meta name="prodname" content="Calibre Cluster Manager (CalCM) User's Manual" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Siemens Industry Software 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2021-03-26" />
<meta name="Topline" content="Siemens EDA" />
<meta name="VariantPrefix" content="none" />
<meta name="Tier" content="2" />
<meta name="SubTitle" content="none" />
<meta name="SourceHandle" content="calbr_cm_user" />
<meta name="SoftwareVersionNum" content="2021.2" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="none" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="calbr_ih" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="March 2021" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="Calibre® Cluster Manager (CalCM) User’s Manual" />
<meta name="CSHelp" content="no" />
<meta name="CSDSearchKeywords" content="doc.type.documentation.user,doc.type.documentation.sys,product.version.v2021.2,product.id.P10101" />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="calibre" />
<meta name="BookcaseHandle" content="none" />
<meta name="Beta" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="IncludeDraftCommentsInChangeLog" content="2021.1" />
<meta name="HighlightChanges" content="yes" />
<meta name="HighlightColor" content="Pale Green" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Creating an Activity Log Application</title>
<link rel="stylesheet" href="../../MGC/styles-disw/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles-disw/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles-disw/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles-disw/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles-disw/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="Creating an Activity Log Application" />
<meta name="attributes" content="doc.type.documentation.user,doc.type.documentation.sys,product.version.v2021.2,product.id.P10101" />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.3.000" />
<script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">Creating an Activity Log Application</h1>
<div class="body taskbody TaskBody"><div class="abstract TaskAbstract"><span class="shortdesc">In this procedure,
you create a CalCM Activity Log application. </span>
</div>
<div class="section prereq Prerequisites p"><div class="tasklabel"><h2 class="sectiontitle tasklabel">Prerequisites</h2></div><ul class="ul"><li class="li" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__idd7a6a386-ff16-4131-b7cd-f8615092817e"><p class="p">An
ASCII editor</p>
</li>
<li class="li" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__idc0caa29e-2254-445d-a7bf-921c521826c0"><p class="p">Knowledge
of HTML is necessary</p>
</li>
</ul>
</div>
<div class="tasklabel"><h2 class="sectiontitle tasklabel">Procedure</h2></div><ol class="ol steps"><li class="li step stepexpand" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__iddb74bbc5-04ed-4824-8938-cafafa07291b"><span class="ph cmd">Set your working directory
to <span class="ph filepath">$HOME/calcm</span>.</span><div class="itemgroup info StepInfo"><pre class="pre ShellCommand">$ cd $HOME/calcm</pre>
</div></li>
<li class="li step stepexpand" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__id10ca7f4f-e773-496c-ad45-49c26846535f"><span class="ph cmd">Open an ASCII editor and enter
the following commands that define the log file path and the increment
value for each update:</span><div class="itemgroup info StepInfo"><pre class="pre codeblock leveled"><code># calcm_actlog_app.tcl -- 
# 
# CalCM application “Activity Log” 
 
# Default path to log file. 
set logFilePath “&lt;<span class="keyword ParameterName OptionalReplaceable">path
to calcm_examples</span>&gt;/calcm.log” 
 
# Increments after each update. 
set updateCount 0 </code></pre></div></li>
<li class="li step stepexpand" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__id732c66e8-a16e-4522-ac96-30164ef59aa7"><span class="ph cmd">Enter the following nemo::application
command to establish the callback interface of the CalCM application:</span><div class="itemgroup info StepInfo"><pre class="pre codeblock leveled"><code># 
# Entry point of CalCM application. 
# 
proc <a class="xref fm:HeadingOnly" href="Command_Nemoapplication_ide04bc1fb.html#ide04bc1fb-a781-4317-99e9-63a6681ad6a4__Command_Nemoapplication_ide04bc1fb.xml#ide04bc1fb-a781-4317-99e9-63a6681ad6a4" title="Establishes the callback interface of CalCM application.">nemo::application</a> {subCmd args} { 
	switch $subCmd { 
		configure       { configureApp [lindex $args 0] } 
		name            { return “Activity Log” } 
		attach          { openLogFile } 
		detach          { closeLogFile } 
		update_status   { updateLog [lindex $args 0] } 
		process_message { processMessage [lindex $args 0] } 
	} 
}</code></pre></div></li>
<li class="li step stepexpand" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__id0619901f-05ce-4e18-b7dc-abe7504caae5"><span class="ph cmd">Enter the configureApp command
which is used to parse the application section of the configuration
file. The configureApp procedure is called by the nemo::application
configure subcommand.</span><div class="itemgroup info StepInfo"><pre class="pre codeblock leveled"><code># 
# Parse application section of configuration file. 
# 
proc configureApp {configText} { 
	global logFilePath 
	foreach line [split $configText "\n"] { 
	regexp {^\s*LOGPATH\s*=\s*(\S+)} $line -&gt; logFilePath 
	} 
}</code></pre></div></li>
<li class="li step stepexpand" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__iddc9f39b4-e415-4fc4-b100-66e822231be9"><span class="ph cmd">Enter the openLogFile, closeLogFile,
and updateLog commands which open, close, and update the log file,
respectively. The openLogFile procedure is called by the nemo::application
attach subcommand, closeLogFile procedure is called by the nemo::application
detach subcommand, and updateLog procedure is called by the nemo::application
update_status subcommand.</span><div class="itemgroup info StepInfo"><pre class="pre codeblock leveled"><code># 
# Open and initialize log file at configured location. 
# 
proc openLogFile {} { 
	global logFilePath logFileId 
	set logFileId [open $logFilePath “w”] 
	puts $logFileId “JOBS,Running jobs,MTflex,Hyperscaling” 
	puts $logFileId “CPUS,CPU usage,Total,Active” 
} 
 
# 
# Close currently open log file. 
# 
proc closeLogFile {} { 
	global logFileId 
	close $logFileId 
} 
 
# 
# Update log file. 
# 
proc updateLog {snapshotObj} { 
	global updateCount logFileId 
	set t [<a class="xref fm:HeadingOnly" href="Command_Nemosnapshot_id789779f0.html#id789779f0-9c3b-448f-bedb-5c0816f4b45c__Command_Nemosnapshot_id789779f0.xml#id789779f0-9c3b-448f-bedb-5c0816f4b45c" title="Analyze the cluster snapshot.">nemo::snapshot</a> timestamp $snapshotObj] 
	set entryId [format "T%04d" $updateCount] 
	set entryTime [clock format $t -format {%T,%d-%b-%Y} -gmt 0] 
	set mtflexJobs 0 
	set hyperscalingJobs 0 
	set totalCpus 0 
	set activeCpus 0 
	foreach jobObj [nemo::snapshot jobs $snapshotObj] { 
		set n [<a class="xref fm:HeadingOnly" href="Command_Nemojob_id593e22ab.html#id593e22ab-dc5f-4ac7-ad64-96086bf13bfd__Command_Nemojob_id593e22ab.xml#id593e22ab-dc5f-4ac7-ad64-96086bf13bfd" title="Returns information on the Calibre job that is running.">nemo::job</a> number_of_masters $jobObj] 
		if {$n == 1} { incr mtflexJobs } 
		if {$n &gt; 1}  { incr hyperscalingJobs } 
	} 
	foreach nodeObj [nemo::snapshot nodes $snapshotObj] { 
		incr totalCpus [<a class="xref fm:HeadingOnly" href="Command_Nemonode_id19c440ca.html#id19c440ca-4732-442f-b363-48a8429a8c5f__Command_Nemonode_id19c440ca.xml#id19c440ca-4732-442f-b363-48a8429a8c5f" title="Returns information about the cluster node.">nemo::node</a> cpu_count $nodeObj] 
		incr activeCpus [nemo::node number_of_processes $nodeObj 
			-type calibre] 
	} 
	puts $logFileId "JOBS,$entryId,$mtflexJobs,$hyperscalingJobs" 
	puts $logFileId "CPUS,$entryId,$totalCpus,$activeCpus" 
	puts $logFileId "ZZZZ,$entryId,$entryTime" 
	flush $logFileId 
	incr updateCount 
}</code></pre></div></li>
<li class="li step stepexpand" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__idce923996-2bdc-454a-8d19-f05ee70349e1"><span class="ph cmd">Enter the processMessage command
which is used to process HTTP requests. The processMessage procedure
is called by the nemo::application process_message subcommand.</span><div class="itemgroup info StepInfo"><pre class="pre codeblock leveled"><code># 
#	Process HTTP requests. 
# 
proc processMessage {messageObj} { 
	global logFilePath 
	set messageText [<a class="xref fm:HeadingOnly" href="Command_Nemomessage_id3530c038.html#id3530c038-b69e-4afe-8ae2-9410403cb77a__Command_Nemomessage_id3530c038.xml#id3530c038-b69e-4afe-8ae2-9410403cb77a" title="Returns message attributes.">nemo::message</a> text $messageObj] 
	if {[regexp {^GET\s+/actlog/?(\S*)\s+HTTP} $messageText -&gt;
			requestDir]} { 
		set replyChannelId [nemo::message channel $messageObj] 
		puts $replyChannelId “&lt;html&gt;&lt;title&gt;[nemo::application name]
			&lt;/title&gt;&lt;body&gt;” 
		switch $requestDir { 
			““ { 
				set fileSize [file size $logFilePath] 
				puts $replyChannelId “Current log file size: $fileSize&lt;br&gt;” 
				puts $replyChannelId “&lt;a href=\”/actlog/view\”&gt;View log
					file&lt;/a&gt;” 
			} 
			“view” { 
				puts $replyChannelId “&lt;pre&gt;” 
				set f [open $logFilePath “r”] 
				while {[gets $f line] != -1} { 
				puts $replyChannelId $line 
				} 
				close $f 
				puts $replyChannelId “&lt;/pre&gt;” 
			} 
			default { 
				puts $replyChannelId “&lt;font size=\”+3\”
					color=\”red\”&gt;404&lt;/font&gt;” 
			} 
		} 
		puts $replyChannelId “&lt;/body&gt;&lt;/html&gt;” 
	} 
} </code></pre></div></li>
<li class="li step stepexpand" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__ida1dfaad1-d4c0-4e88-8937-c0869cc785a9"><span class="ph cmd">Save the file as <span class="ph filepath">calcm_actlog_app.tcl</span>.</span></li>
<li class="li step stepexpand" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__id08c4f469-4179-41da-81a5-79c298f72693"><span class="ph cmd">Close the file.</span></li>
<li class="li step stepexpand" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__ida88824d4-65c9-4324-87e6-978dae0c3921"><span class="ph cmd">Verify your working directory
is set to <span class="ph filepath">$HOME/calcm</span> and invoke CalCM.</span><div class="itemgroup info StepInfo"><pre class="pre ShellCommand">	$ calcmd -simulation -config calcmd.conf</pre>
</div></li>
<li class="li step stepexpand" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__id56d34121-3f8a-453f-8c87-a1a5fbc9bf1a"><span class="ph cmd">Allow the application to run
for several minutes.</span></li>
<li class="li step stepexpand" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__idf57f7246-1939-4f2a-b6a7-184a93e67078"><span class="ph cmd">Press Ctrl-C to exit CalCM.</span></li>
<li class="li step stepexpand" id="id2b0e54b1-e02e-4ded-a631-ae7f21f1c79d__id23a015f5-00ea-41f6-8228-d01e7f3c0fa7"><span class="ph cmd">Review the <span class="ph filepath">calcm.log</span> file
that was generated by the Activity Log application. The format of
the log file is as follows:</span><div class="itemgroup info StepInfo"><pre class="pre codeblock leveled"><code>JOBS,Running jobs,MTflex,Hyperscaling 
CPUS,CPU usage,Total,Active 
JOBS,T0000,1,0 
CPUS,T0000,19,8 
ZZZZ,T0000,15:25:41,01-Dec-2009 
JOBS,T0001,1,0 
CPUS,T0001,19,8 
ZZZZ,T0001,15:27:42,01-Dec-2009 
JOBS,T0002,1,0 
CPUS,T0002,19,8 
ZZZZ,T0002,15:29:47,01-Dec-2009 
JOBS,T0003,1,0 
CPUS,T0003,19,8 
ZZZZ,T0003,15:31:52,01-Dec-2009</code></pre><p class="p">Notice the log file is updated approximately
every two minutes. This is the default update interval.</p>
</div></li>
</ol>
<div class="section result"><div class="tasklabel"><h2 class="sectiontitle tasklabel">Results</h2></div><p class="p">You should now have an activity log
application and can use the information learned in this exercise
to create custom CalCM Tcl applications.</p>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/MGCAppe_DevelopingCalcmApplications_id7f3060be.html" title="This section provides information on using Tcl to develop custom CalCM applications.">Developing CalCM Applications</a></div>
</div>

<div class="linklist linklist relinfo"><strong>Related Topics</strong><br />

<div><a class="link" href="../topics/Command_Nemoapplication_ide04bc1fb.html#ide04bc1fb-a781-4317-99e9-63a6681ad6a4__" title="Establishes the callback interface of CalCM application.">nemo::application</a></div>
<div><a class="link" href="../topics/Command_Nemojob_id593e22ab.html#id593e22ab-dc5f-4ac7-ad64-96086bf13bfd__" title="Returns information on the Calibre job that is running.">nemo::job</a></div>
<div><a class="link" href="../topics/Command_Nemomessage_id3530c038.html#id3530c038-b69e-4afe-8ae2-9410403cb77a__" title="Returns message attributes.">nemo::message</a></div>
<div><a class="link" href="../topics/Command_Nemonode_id19c440ca.html#id19c440ca-4732-442f-b363-48a8429a8c5f__" title="Returns information about the cluster node.">nemo::node</a></div>
<div><a class="link" href="../topics/Command_Nemosnapshot_id789779f0.html#id789779f0-9c3b-448f-bedb-5c0816f4b45c__" title="Analyze the cluster snapshot.">nemo::snapshot</a></div></div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter"> </div><div class="Footer" id="Footer"> </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "calbr_cm_user"
                DocTitle = "Calibre® Cluster Manager (CalCM) User’s Manual"
                PageTitle = "Creating an Activity Log Application"
                Copyright = "2021"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/TaskTop_CreatingActivityLogApplication_id2b0e54b1.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">Calibre® Cluster Manager (CalCM) User’s Manual, v2021.2<br />Unpublished work. © 2021 Siemens 
                <br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>