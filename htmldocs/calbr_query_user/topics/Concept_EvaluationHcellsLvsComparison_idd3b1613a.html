<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2021" />
<meta name="DC.rights.owner" content="(C) Copyright 2021" />
<meta name="DC.Type" content="ConceptTopic" />
<meta name="DC.Title" content="Evaluation of Hcells for LVS Comparison" />
<meta name="abstract" content="Hcells in the current hcell list should be evaluated for their effectiveness in LVS comparison. This can be done initially in the Query Server Tcl shell. Ultimately, every hcell list used for LVS comparison should be tested in Calibre nmLVS-H." />
<meta name="description" content="Hcells in the current hcell list should be evaluated for their effectiveness in LVS comparison. This can be done initially in the Query Server Tcl shell. Ultimately, every hcell list used for LVS comparison should be tested in Calibre nmLVS-H." />
<meta name="DC.subject" content="Hcell analysis, for LVS comparison" />
<meta name="keywords" content="Hcell analysis, for LVS comparison" />
<meta name="prodname" content="Calibre Query Server Manual" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Siemens Industry Software 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2021-03-13" />
<meta name="Topline" content="Siemens EDA" />
<meta name="VariantPrefix" content="none" />
<meta name="Tier" content="1" />
<meta name="SubTitle" content="none" />
<meta name="SourceHandle" content="calbr_query_user" />
<meta name="SoftwareVersionNum" content="2021.2" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="14" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="calbr_ih" />
<meta name="IncludeDraftCommentsInChangeLog" content="21.2;show" />
<meta name="HighlightColor" content="mgc_yellow_129_50" />
<meta name="HighlightChanges" content="yes" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="March 2021" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="Calibre® Query Server Manual" />
<meta name="CSHelp" content="NO" />
<meta name="CSDSearchKeywords" content="doc.type.documentation.user,product.version.v2021.2,product.id.P11713,product.id.P10099,product.id.P10087,product.id.P10084,product.id.P11347,product.id.P11427" />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="calibre" />
<meta name="BookcaseHandle" content="none" />
<meta name="Beta" content="none" />
<meta name="Alpha" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="idd3b1613a-552d-4ed9-a7d5-5a8a1f4c8a3f" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Evaluation of Hcells for LVS Comparison</title>
<link rel="stylesheet" href="../../MGC/styles-disw/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles-disw/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles-disw/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles-disw/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles-disw/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="Evaluation of Hcells for LVS Comparison" />
<meta name="attributes" content="doc.type.documentation.user,product.version.v2021.2,product.id.P11713,product.id.P10099,product.id.P10087,product.id.P10084,product.id.P11347,product.id.P11427" />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.3.000" />
<meta name="has_video" content="true" /><script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body id="idd3b1613a-552d-4ed9-a7d5-5a8a1f4c8a3f">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">Evaluation of Hcells for LVS Comparison</h1>
<div class="body conbody ConceptBody"><div class="abstract ConceptAbstract"><span class="shortdesc">Hcells in the
current hcell list should be evaluated for their effectiveness in
LVS comparison. This can be done initially in the Query Server Tcl
shell. Ultimately, every hcell list used for LVS comparison should
be tested in Calibre nmLVS-H.</span>
</div>
<p class="p">The <a class="xref fm:HeadingOnly" href="Command_Hcellsselect_id800f46ec.html#id800f46ec-8317-4bd6-ac24-e3dddcab008d__Command_Hcellsselect_id800f46ec.xml#id800f46ec-8317-4bd6-ac24-e3dddcab008d" title="Selects hcells in the current hcell list and any automatically matched cells. Generates a report of the current hcell statistics.">hcells::select</a> command measures the effectiveness
of cells at reducing the <span class="ph FontProperty emphasis">total hierarchical instance count</span> (THIC) of the design,
and the proportion of internal instance counts within cells compared
to the total instance count of the design. (For the remainder of
this discussion, reviewing the “<a class="xref fm:HeadingAndPage" href="FileRef_HcellEvaluationReportFormat_id1ad3fb45.html#id1ad3fb45-10a5-4dce-9398-bf73a941e6f2__FileRef_HcellEvaluationReportFormat_id1ad3fb45.xml#id1ad3fb45-10a5-4dce-9398-bf73a941e6f2" title="Hcell analysis report showing the effectiveness of hcells.">Hcell Evaluation Report Format</a>” can be
helpful.) THIC is only applied as a selection criterion when hcells::select
is used.</p>
<p class="p">THIC is defined as the number of primitive devices and hcell
placements in the design after it is flattened based upon rule file
settings and internal heuristics (including unbalanced hcell expansion,
flattening inside cells, cell copies made for one-to-many hcells,
and so forth), but before any device reductions occur. Device filtering
is accounted for, but unused device filtering is not.</p>
<p class="p">THIC varies with the set of hcells. The improvement percentage
in THIC is the primary measure for an hcell’s efficiency. This percentage
gives the factor by which THIC can be reduced by the addition of
the given hcell, assuming all previously listed hcells were in place prior
to the addition.</p>
<p class="p">The remaining potential improvement is an estimate of how much
more improvement is possible, based on comparison with the lesser
of the THIC with all candidate cells added as hcells, or the least
THIC calculated to that point.</p>
<p class="p">Candidate cells come from automatic matching (automatching, or
automatch) if enabled, placement matching if enabled, and existing
hcells in the hcell list if evaluation of current hcells is enabled.
If evaluation of current hcells is disabled, all candidates are
added as hcells that were in the current hcell list prior to invoking
hcells::select. Then the remainder of the selection process starts. </p>
<p class="p">The hcells::select
command sets the thresholds for measuring effectiveness of cells
in the current hcell list. Effectiveness thresholds ensure that
the most effective hcells are selected. More specifically, these
are the cases:</p>
<ul class="ul"><li class="li" id="idd3b1613a-552d-4ed9-a7d5-5a8a1f4c8a3f__idf6d39575-8d0e-4b0f-9f04-42c65cdb17fd"><p class="p">Evaluation
of current hcells is enabled (<a class="xref fm:HeadingOnly" href="Command_HcellsevaluateCurrentHcells_idee492079.html#idee492079-65a7-4d4d-87f5-86984c272696__Command_HcellsevaluateCurrentHcells_idee492079.xml#idee492079-65a7-4d4d-87f5-86984c272696" title="Controls hcell effectiveness evaluation.">hcells::evaluate_current_hcells</a> -yes,
the default). In this case, the candidate set of hcells will include
all hcells in the current hcell list, plus any hcells found by automatching
or placement matching (if enabled). Before selection begins, the
current hcell list is cleared. Then hcells taken from the candidate list
are added to the list until the thresholds are met. The result is
the set of selected hcells. Cells are picked from the candidate
list in order of estimated effectiveness at reducing the THIC.</p>
</li>
<li class="li" id="idd3b1613a-552d-4ed9-a7d5-5a8a1f4c8a3f__id15ec4800-00eb-4274-917b-daed8541cf4e"><p class="p">Evaluation
of current hcells is disabled. In this case, the candidate set of
hcells will only include hcells found by automatching or placement
matching (if enabled). The current hcell list is not cleared before
beginning. Cells are picked from the candidate list to be added
to the current hcell list until the thresholds are met. Again, cells
are picked in order of estimated effectiveness at reducing the THIC.</p>
</li>
</ul>
<p class="p">To illustrate the need for effectiveness measurement, <a class="xref fm:HeadingOnly" href="Command_Hcellsautomatch_idff09ee4f.html#idff09ee4f-3e02-4984-895c-f4c168ac8e7f__Command_Hcellsautomatch_idff09ee4f.xml#idff09ee4f-3e02-4984-895c-f4c168ac8e7f" title="Identifies layout and source cells that match by name.">hcells::automatch</a> selects all cells that have the
same name in layout and source. Many of those are small cells (like
vias), or cells that appear only a few times in the design and have
few internal instances. These cells contribute virtually nothing
to reducing data size or execution time, and sometimes may even
degrade performance if used as hcells. (Automatched cells may also
result in discrepancies, for example, when the layout version of
the cell does not closely correspond to the source.) Using hcells::automatch
-strict with a reasonable hcell::select effectiveness threshold
can result in a better preliminary hcell list.</p>
<p class="p">The <a class="xref fm:HeadingOnly" href="Command_Hcellsselect_id800f46ec.html#id800f46ec-8317-4bd6-ac24-e3dddcab008d__Command_Hcellsselect_id800f46ec.xml#id800f46ec-8317-4bd6-ac24-e3dddcab008d" title="Selects hcells in the current hcell list and any automatically matched cells. Generates a report of the current hcell statistics.">hcells::select</a> command iteratively identifies
hcells based upon their potential to reduce the THIC, given the
existing set of hcells (including those chosen on previous iterations).
By default, the savings threshold is set so that when the potential
remaining THIC savings falls below 30 percent, further hcells will
not be selected unless they meet the instance count criterion.</p>
<p class="p">The hcells::select command also considers the
instance count in a cell (at its top level) and compares this to
the total flat instance count of the design. By default, if a cell’s
internal instance count represents one percent of the total flat
instance count of the design, that cell is selected as an hcell,
even if it contributes nothing to THIC savings. This instance count threshold
ensures large cells with many instances can also serve as hcells.
The instance counts are shown in the Instance Count In This Cell
column of the hcell evaluation report.</p>
<p class="p">When hcells::evaluate_current_hcells -no is
set, current hcells are always kept in the current hcell list regardless
of whether they actually meet the evaluation thresholds.</p>
<p class="p">Following is an example of hcell report generation
where both layout and source are assumed to be SPICE. </p>
<pre class="pre codeblock leveled"><code>$ calibre -qs 
&gt; <a class="xref fm:HeadingOnly" href="Command_Hcellsautomatch_idff09ee4f.html#idff09ee4f-3e02-4984-895c-f4c168ac8e7f__Command_Hcellsautomatch_idff09ee4f.xml#idff09ee4f-3e02-4984-895c-f4c168ac8e7f" title="Identifies layout and source cells that match by name.">hcells::automatch</a> -strict 
&gt; <a class="xref fm:HeadingOnly" href="Command_Hcellsread_ida90639f7.html#ida90639f7-3ab1-463e-a7a0-ebec97969e4f__Command_Hcellsread_ida90639f7.xml#ida90639f7-3ab1-463e-a7a0-ebec97969e4f" title="Reads in the layout and source netlists, along with any Hcell statements that may be in the rule file.">hcells::read</a> -rules lvs.rules 
&gt; <a class="xref fm:HeadingOnly" href="Command_Hcellsselect_id800f46ec.html#id800f46ec-8317-4bd6-ac24-e3dddcab008d__Command_Hcellsselect_id800f46ec.xml#id800f46ec-8317-4bd6-ac24-e3dddcab008d" title="Selects hcells in the current hcell list and any automatically matched cells. Generates a report of the current hcell statistics.">hcells::select</a> -file cells.report 
&gt; <a class="xref fm:HeadingOnly" href="Command_HcellsprintHcells_id9f8cdeaa.html#id9f8cdeaa-aeb8-4884-877f-d5048efe8358__Command_HcellsprintHcells_id9f8cdeaa.xml#id9f8cdeaa-aeb8-4884-877f-d5048efe8358" title="Writes the current list of hcells.">hcells::print_hcells</a> -file hcells </code></pre><p class="p">This script identifies
hcell candidates based upon the strict automatch algorithm, which
is discussed in the hcells::automatch documentation. Additionally,
any <a class="xref Link" href="../../svrf_ur/nsmgchelp.htm" target="_top" onclick="oT('STD_FM11', 'Hcell', 'svrf_ur'); return false;">Hcell</a> specification statements
in the rule file are read. The entire collection of hcell candidates
are then evaluated against the thresholds (which are defaults in
this case).</p>
<div class="note note"><span class="notetitle">Note:</span> <p class="p">If
the layout is geometric, then only the source netlist is evaluated,
and hcells::select does not evaluate hcell effectiveness thresholds.</p>
</div>
<p class="p">The contents of the <span class="ph filepath">cells.report</span> file
are the same as the ones generated by the <a class="xref fm:HeadingOnly" href="Command_NetlistSelectHcells_idf6950ed6.html#idf6950ed6-f4c7-4f75-b68b-83c78e892e62__Command_NetlistSelectHcells_idf6950ed6.xml#idf6950ed6-f4c7-4f75-b68b-83c78e892e62" title="Sets the current hcell list and generates an evaluation report.">NETLIST SELECT HCELLS</a> command.</p>
<p class="p">The <a class="xref fm:HeadingOnly" href="Command_HcellsprintHierarchy_id2db51551.html#id2db51551-3bec-4242-a860-e0f2a7ee8ddd__Command_HcellsprintHierarchy_id2db51551.xml#id2db51551-3bec-4242-a860-e0f2a7ee8ddd" title="Writes a hierarchy tree report of cell statistics.">hcells::print_hierarchy</a> command
prints a hierarchy report that can be useful when adding or removing
hcells from the current list. See “<a class="xref fm:HeadingAndPage" href="Concept_NetlistHcellAnalysisAndReportingFlow_idba33c447.html#idba33c447-2bca-4152-81dd-b8ff71706d15__Concept_NetlistHcellAnalysisAndReportingFlow_idba33c447.xml#idba33c447-2bca-4152-81dd-b8ff71706d15" title="The hcell analysis and hierarchy tree reports are useful for finding hcells for hierarchical LVS comparison. The report ranks cells in order of potential value as hcells (assuming that a matching hcell can be found).">Netlist Hcell Analysis and Reporting Flow</a>”. You
can use <a class="xref fm:HeadingOnly" href="Command_Hcellshcell_id758267ad.html#id758267ad-40c5-413c-9758-f191ece7befe__Command_Hcellshcell_id758267ad.xml#id758267ad-40c5-413c-9758-f191ece7befe" title="Adds a single hcell pair to the current hcell list. The cells should be topologically identical, otherwise unpredictable problems can occur in LVS comparison.">hcells::hcell</a> to add hcells to the current list
and <a class="xref fm:HeadingOnly" href="Command_HcellsclearHcell_idedba76e6.html#idedba76e6-7c22-4f99-91c1-374d4e6bd6b0__Command_HcellsclearHcell_idedba76e6.xml#idedba76e6-7c22-4f99-91c1-374d4e6bd6b0" title="Removes a corresponding cell pair from the current hcell list.">hcells::clear_hcell</a> to remove hcells from the current
list.</p>
<p class="p">The final generated hcell list should be thoroughly
tested in LVS runs to ensure it performs well and produces valid
results.</p>
<div class="p Video"><a class="xref fm-xref-container VideoXref" target="_blank" href="../../../videos/calbr_query_hcells_ht_vid/index.html" handle="calbr_query_hcells_ht_vid" jobid="19CD5C81_D0F3_1014_A46E_F9C74018DE25" webid="3d281be6-af1a-4737-8d35-454ecce8555a" title="Finding Hcells to Improve LVS-H Performance" description="This video demonstrates how to generate a list of hierarchical cells with Calibre Query Server to improve the performance of Calibre nmLVS-H." recorded_version="2017.1" verified_version="2017.1" categories=""><br /><div class="imagecenter"><img class="image imagecenter fmdpi:96" src="../graphics/video_thumbnails/calbr_query_hcells_ht_vid_id19CD5C81_medium.png" /></div><br /></a></div>
<div class="section Subsections"><div class="section Subsection" id="idd3b1613a-552d-4ed9-a7d5-5a8a1f4c8a3f__ida0ca7104-4005-4e69-ac45-c2efd952fc4f"><h2 class="title Subheading sectiontitle">Hcell Cycles and Conflicts</h2><p class="p">An hcell cycle occurs when there is a circular chain of references
among hcells. This is an error and is discussed in detail under
“<a class="xref Link" href="../../calbr_ver_user/nsmgchelp.htm" target="_top" onclick="oT('STD_FM11', 'Hierarchical Cells Forming a Cycle', 'calbr_ver_user'); return false;">Hierarchical Cells Forming a Cycle</a>” in the <cite class="cite">Calibre Verification User’s Manual</cite>.</p>
<p class="p">An hcell conflict is a pair of cells that should correspond,
except that this would result in a one-to-many correspondence where
some cell on the “many” side is the ancestor of another cell on the
“many” side. In that case, if these cells were made to correspond,
there would be a cycle in the merged hierarchy, thus giving an error.</p>
<p class="p">Every conflict implies a cycle could be formed, but not every
cycle arises from a conflict. If a conflict is detected, cells are
made not to correspond as hcells so the cycle is averted. </p>
<p class="p">The processing order of cells in hierarchical LVS comparison
is different from the hcell selection algorithm in the Query Server,
so it is possible there is a difference in which hcells involved
in a conflict are discarded. As a result, there can be cases in
LVS comparison where conflicts are detected where the hcell list
came from the Query Server. If this occurs, the following warning
is given:</p>
<p class="p BlockIndent">WARNING: Cell &lt;name&gt; cannot be made to correspond
with cell &lt;name&gt; due to a hierarchical conflict.</p>
<p class="p">If this occurs, you should examine the hierarchy of your designs
and the hcell list to determine how to modify the hcell list to
avoid the conflict.</p>
</div>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/MGCChap_HcellHierarchicalAnalysis_id86fc4afd.html" title="Hcells define correspondences between layout and source cells in hierarchical LVS. Calibre nmLVS-H cannot generally determine these correspondences if the subcircuit names are different in the two designs, so a user-defined hcell list is needed in that case. Furthermore, simply because cell names may match between layout and source designs does not mean the pair will make good hcells. The Query Server can assist in finding a prospective set of hcells that act as design partitions to improve comparison efficiency and to make debugging simpler.">Hcell and Hierarchical Analysis</a></div>
</div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter"> </div><div class="Footer" id="Footer"> </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "calbr_query_user"
                DocTitle = "Calibre® Query Server Manual"
                PageTitle = "Evaluation of Hcells for LVS Comparison"
                Copyright = "2021"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/Concept_EvaluationHcellsLvsComparison_idd3b1613a.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">Calibre® Query Server Manual, v2021.2<br />Unpublished work. © 2021 Siemens 
                <br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>