<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2021" />
<meta name="DC.rights.owner" content="(C) Copyright 2021" />
<meta name="DC.Type" content="GeneralRefTopic" />
<meta name="DC.Title" content="Example: Report Hierarchy" />
<meta name="abstract" content="This script reports hierarchy statistics for cells and placements in the DFM database. This report can be useful when analyzing hierarchy produced by the Calibre hierarchical database constructor." />
<meta name="description" content="This script reports hierarchy statistics for cells and placements in the DFM database. This report can be useful when analyzing hierarchy produced by the Calibre hierarchical database constructor." />
<meta name="prodname" content="Calibre YieldServer Reference Manual" />
<meta name="version" content="2014.06" />
<meta name="release" content="v2014.06" />
<meta name="series" content="mgc_ih" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Creator" content="Mentor Graphics Corporation" />
<meta name="DC.Publisher" content="Siemens Industry Software 10 24 2014 10 24 2014 Fresh off the boat." />
<meta name="DC.Date.Created" content="0000-00-00" />
<meta name="DC.Date.Modified" content="2021-03-08" />
<meta name="Topline" content="Siemens EDA" />
<meta name="VariantPrefix" content="none" />
<meta name="Tier" content="1" />
<meta name="SubTitle" content="none" />
<meta name="SourceHandle" content="calbr_ys_ref" />
<meta name="SoftwareVersionNum" content="2021.2" />
<meta name="SoftwareRelease" content="none" />
<meta name="RevHist" content="14" />
<meta name="PublicationDate" content="none" />
<meta name="Platform" content="none" />
<meta name="PartNumber" content="none" />
<meta name="LicenseType" content="EULA" />
<meta name="InfoHubHandle" content="calbr_ih" />
<meta name="IncludeDraftCommentsInChangeLog" content="21.2;show" />
<meta name="HighlightColor" content="mgc_yellow_129_50" />
<meta name="HighlightChanges" content="yes" />
<meta name="EclipsePluginName" content="none" />
<meta name="DraftDate" content="March 2021" />
<meta name="Draft" content="none" />
<meta name="DocumentTitle" content="Calibre® YieldServer Reference Manual" />
<meta name="CSHelp" content="NO" />
<meta name="CSDSearchKeywords" content="doc.type.documentation.ref,product.version.v2021.2,product.id.P11347,product.id.P11426,product.id.P11713,product.id.P10087,product.id.P11493" />
<meta name="Copyright" content="READONLY - Use: copyrfirst and copyrlast" />
<meta name="ConditionFiltering" content="XML" />
<meta name="ChecklinksRelease" content="calibre" />
<meta name="BookcaseHandle" content="none" />
<meta name="Beta" content="none" />
<meta name="Alpha" content="none" />
<meta name="ActiveStatus" content="Active" />
<meta name="GenerateOnlyChangedTopics" content="none" />
<meta name="IncludeInInventory" content="yes" />
<meta name="SourceEDDVersion" content="12.2.10" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="id7fed7ea4-48ab-421b-b0eb-16d9495a2aa7" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>Example: Report Hierarchy</title>
<link rel="stylesheet" href="../../MGC/styles-disw/mgcdita-lang.css" type="text/css" /><noscript><link rel="StyleSheet" href="../../MGC/styles-disw/body.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles-disw/catalog.css" type="text/css" /><link rel="StyleSheet" href="../../MGC/styles-disw/document.css" type="text/css" /><link rel="stylesheet" href="../../MGC/styles-disw/mgcdita-lang.css" type="text/css" /></noscript><meta name="mgc_html_doctitle" content="Example: Report Hierarchy" />
<meta name="attributes" content="doc.type.documentation.ref,product.version.v2021.2,product.id.P11347,product.id.P11426,product.id.P11713,product.id.P10087,product.id.P11493" />
<meta name="TEMPLATEBASE" content="mgc_mgchelp_v4.3.000" />
<script type="text/javascript" language="JavaScript1.2" src="../../MGC/js/page.js"></script><script type="text/javascript" language="JavaScript1.2">
            if(DetectChromeForBasic()){
            writeNoScriptStyles();
            }

        </script><script type="text/javascript" language="JavaScript1.2">
            // Set reference to top level help frame
            //
            if(!DetectChromeForBasic()){
            javascriptTopicRedirect();
            }
        </script></head>
<body class="default" id="id7fed7ea4-48ab-421b-b0eb-16d9495a2aa7">
<div id="bodycontent" class="BodyContent">
<script type="text/javascript" language="JavaScript1.2">
              var BC = new Array("TODO: Breadcrumb Title","title1","naV","naV","naV","naV","2");
          </script>
<noscript><iframe framespacing="0" marginheight="2px" frameborder="no" scrolling="no" src="../../MGC/html/noscript_header.htm" width="100%" height="100px;">xxx</iframe></noscript>
<script type="text/javascript" language="JavaScript1.2">
              if(DetectChromeForBasic()){
              if(!(top.inEclipse)){
              writeBasicHeader();
              }
              }
          </script>
<div id="BodyContent"><h1 class="title topictitle1">Example: Report Hierarchy</h1>
<div class="body refbody GeneralRefBody"><div class="abstract GeneralRefAbstract"><span class="shortdesc">This script reports hierarchy statistics
for cells and placements in the DFM database. This report can be
useful when analyzing hierarchy produced by the Calibre hierarchical
database constructor.</span>
</div>
<div class="section Subsections"><div class="section Subsection" id="id7fed7ea4-48ab-421b-b0eb-16d9495a2aa7__id45197c4f-6605-468c-8dd8-5131bde5a646"><p class="p">The
first portion of the script lists all cells in the design, the number
of hierarchical levels in each cell, and the number of times each
cell is placed.</p>
<p class="p">The second portion of the script prints a complete hierarchical
tree of the layout design showing cell placements and the levels
at which they are placed. As this output is verbose and can give large
amounts of output, the header to this part of the report and the
call to the write_tree proc are commented out.</p>
<pre class="pre codeblock"><code>#
# Calibre YieldServer script to report cell instantiations and hierarchy 
# levels.
#
# Call from calibre -ys -exec option or DFM YS AUTOSTART. In the latter 
# case, source it from a TVF FUNCTION block in the rules.
#
#########################################################################
# use this for pretty output
package require struct::matrix

# set this to 1 to turn on debugging trace
# set DEBUG 1;

############################# PROCESS DATABASE ##########################
# get names of all cells in the database
set cells [dfm::get_cells];

while {$cells != ""} {
  set cellName [dfm::get_data $cells -cell_name];
  lappend cellList $cellName;
  dfm::inc cells;
}

# get the total cell count
set cellCount [llength $cellList];

# test for hierarchy and exit if there is none
if { $cellCount &lt; "2" } {
  puts "\n NOTE: Layout has no hierarchy. Nothing to do. \n";
  exit 0;
} 
# put any debug diagnostics here
if { [info exists DEBUG] == 1 } { 
    puts "\n---$cellCount layout cells: \n\n[regsub -all { } \
      [lsort $cellList] "\n"] \n";
};</code></pre><pre class="pre codeblock"><code>#########################################################################
# PROC: hier_count; outputs calculates the number of hierarchical levels 
# of a cell.
# cells  = child cells of a cell  
# level  = hierarchical level, indexed from 0
#########################################################################
proc hier_count { cells level } { 
# if this proc is called, there is an additional level of hierarchy
  incr level; 
  set currentCells $cells;
  set newCells "";

# track cells at a given level
  foreach child $currentCells { 
    append newCells "[dfm::list_children $child] ";
  } 

  if { [lindex $newCells 0] != "" } {
    hier_count $newCells $level;
  } else {
    return $level;
  }
} </code></pre><pre class="pre codeblock"><code>puts "\n\n            CELL HIERARCHY LEVELS AND INSTANTIATIONS"
puts "---------------------------------------------------------------\n";
# iterate over all cells.
set hierList "";

foreach cell $cellList {
  set plCount [dfm::get_placement_count $cell]
  set childCells [dfm::list_children $cell]
# if there are child cells, process to find the number of hierarchy 
# levels, otherwise add to the list with hierarchy as &lt;0&gt;
  if { [llength $childCells] &gt; 0 } {
    lappend hierList [list $cell "levels: [hier_count "$childCells" 0]"\
      "instantiations: $plCount"];
  } else {
    lappend hierList [list $cell "levels: 0" "instantiations: $plCount"];
  }
}</code></pre><pre class="pre codeblock"><code># output the cell list in ascii order
# create a 3-column matrix for printing
struct::matrix m0;
m0 add columns 3;
set sortList [lsort $hierList];
set sortListLength [llength $sortList];

for {set i 0} {$i &lt; $sortListLength} {incr i} {
# if struct::matrix is not available, use next line for output instead
#  puts "---[lindex $sortList $i]";
  m0 add row "---[lindex $sortList $i]";
}
# output the table
m0 format 2chan;
puts "\n";</code></pre><pre class="pre codeblock"><code>#########################################################################
# PROC: write_tree; outputs hierarchy tree of design 
# cell   = cell to begin dumping from, "" means use topcell 
# indent = string to format the hierarchy 
# level  = hierarchical level, indexed from 0
#########################################################################
proc write_tree { level {cell ""} {indent ""}  } { 

  if { $cell == 0 } {
    puts "\n ERROR: Cannot determine top cell.";
    exit 1;
  }

# get placements in a cell
  set pl [dfm::get_placements $cell]
# write the cell placement in the tree
  puts "$indent &lt;$level&gt; $cell"; 
# adjust the indent level of the tree
  append indent "    ";
# increment the level
  incr level; 
# recursively call this proc to descend all branches of the hierarchy
  while {$pl != ""} {
    set plName [dfm::get_data $pl -cell_name];
    write_tree $level $plName $indent;
    dfm::inc pl;
  } 
} 

# OUTPUT FROM THIS PART IS VERBOSE! UNCOMMENT TO CALL IT.
# puts "\n\n                        HIERARCHY TREE"
# puts "-------------------------------------------------------------\n";

# call the write_tree proc. hierarchy level is 0 beginning with top cell
# write_tree 0 [dfm::get_top_cell]; # UNCOMMENT TO WRITE TREE;

puts "\n\n---Done.\n"
exit -force
}</code></pre><p class="p">Output from the first part of the report appears like this:</p>
<pre class="pre codeblock"><code>            CELL HIERARCHY LEVELS AND INSTANTIATIONS
---------------------------------------------------------------
Loading hierarchy and connectivity
---CellA   levels: 1 instantiations: 2
---CellB   levels: 1 instantiations: 1
---TOPCELL levels: 2 instantiations: 0
---inv     levels: 0 instantiations: 1
---nand    levels: 0 instantiations: 2</code></pre><p class="p">When enabled, the tree report appears like this (output can be
extensive):</p>
<pre class="pre codeblock"><code>                        HIERARCHY TREE
---------------------------------------------------------------
 &lt;0&gt; TOPCELL
     &lt;1&gt; CellA
         &lt;2&gt; nand
     &lt;1&gt; CellA
         &lt;2&gt; nand
     &lt;1&gt; CellB
         &lt;2&gt; inv</code></pre></div>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent Topic:</strong> <a class="link" href="../topics/MGCAppe_CalibreYieldserverExampleScripts_idd1002f11.html" title="These scripts generate iterators, step through iterators, obtain data from iterator objects, traverse hierarchy, and output information. The methods employed are applicable in solving other problems.">Calibre YieldServer Example Scripts</a></div>
</div>
</div></div>
</div>
<!--BeginFooterContent--><div class="BlankFooter" id="BlankFooter"> </div><div class="Footer" id="Footer"> </div><script type="text/javascript"><!--
                PDFLinkTitle = "InfoHub.Help"
                DocHandle = "calbr_ys_ref"
                DocTitle = "Calibre® YieldServer Reference Manual"
                PageTitle = "Example: Report Hierarchy"
                Copyright = "2021"
                ThisTopic = "PointingtoaCommoncustomerjsFile";
                CurrentFile = "topics/General_ExampleReportHierarchy_id7fed7ea4.html"
                CurrentFileID = "3";
                topicFooter();
            --></script><noscript><p class="MGCFooter">Calibre® YieldServer Reference Manual, v2021.2<br />Unpublished work. © 2021 Siemens 
                <br /><a href="../../mgc_html_help/nsmgchelp.htm" target="_blank">Browser Requirements</a></p></noscript></body>
</html>